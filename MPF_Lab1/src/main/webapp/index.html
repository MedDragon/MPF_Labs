<!doctype html>
<html lang="uk">
<head>
    <meta charset="utf-8">
    <title>Відгуки</title>
</head>
<body>
<h2>Книга відгуків</h2>

<form id="f" style="margin-bottom:1rem">
    <input name="author" placeholder="Ваше ім'я" required maxlength="64">
    <input name="text"   placeholder="Ваш відгук" required maxlength="1000" style="width:50%">
    <button type="submit">Надіслати</button>
</form>

<ul id="list"></ul>

<script>
    // Функція для завантаження коментарів з сервера (GET /comments)
    async function load(){
        const r = await fetch('/comments');
        const a = await r.json();
        const ul = document.getElementById('list');
        ul.innerHTML = '';

        if(!a.length){
            ul.innerHTML = '<li>Ще немає відгуків</li>';
            return;
        }

        a.forEach(c => {
            const li = document.createElement('li');
            li.textContent = `${c.author}: ${c.text}`;
            ul.appendChild(li);
        });
    }

    // Обробка відправки форми (POST /comments)
    document.getElementById('f').addEventListener('submit', async e => {
        e.preventDefault();
        const fd = new FormData(e.target);
        const r = await fetch('/comments', {
            method: 'POST',
            body: new URLSearchParams(fd) // Важливо для коректного зчитування параметрів у Servlet
        });

        if (r.ok){
            e.target.reset();
            load();
        } else {
            alert('Помилка: ' + (await r.text()));
        }
    });

    // Завантажити при відкритті сторінки
    load();
</script>
</body>
</html>